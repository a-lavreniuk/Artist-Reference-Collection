/**
 * История изменений ARC
 * Для показа пользователям при обновлении
 */

export interface VersionChange {
  version: string;
  date: string;
  changes: string[];
}

/**
 * Changelog приложения
 * Последняя версия должна быть первой в массиве
 */
export const changelog: VersionChange[] = [
  {
    version: '1.3.4',
    date: '',
    changes: [
      'Оптимизированы обновления данных во всех разделах — заменены полные перезагрузки на оптимистичные обновления состояния',
      'Исправлена потеря позиции скролла при манипуляциях в разделах — теперь позиция сохраняется при всех операциях',
      'Улучшена производительность интерфейса — операции с категориями, метками, коллекциями и карточками выполняются мгновенно',
      'Исправлены пустые состояния — элементы размещены в левом верхнем углу без лишних отступов',
      'Обновлены тексты пустых состояний для разных разделов (коллекции, мудборд, поиск дублей)',
      'Добавлена обработка ошибок с автоматическим откатом изменений при сбоях операций'
    ]
  },
  {
    version: '1.3.3',
    date: '',
    changes: [
      'Реализована пагинация загрузки карточек с автоматической подгрузкой при скролле — приложение работает быстрее с большими коллекциями',
      'Добавлена генерация трех размеров превью (blur 20px, compact 256px, standard 512px) в формате WebP для оптимальной производительности',
      'Реализована blur-up техника для плавной загрузки изображений — размытый placeholder мгновенно появляется, затем плавно заменяется на четкое изображение',
      'Оптимизированы операции базы данных: батчинг обновлений, использование индексов IndexedDB, кеширование результатов поиска',
      'Улучшена производительность поиска через использование встроенных индексов IndexedDB вместо фильтрации в памяти',
      'Оптимизирована загрузка коллекций и мудборда через bulkGet для получения только нужных карточек',
      'Добавлен in-memory кеш для изображений с LRU стратегией для снижения нагрузки на декодирование'
    ]
  },
  {
    version: '1.3.2',
    date: '',
    changes: [
      'Кардинально улучшен алгоритм поиска дублей изображений — теперь используется DCT-based perceptual hash',
      'Увеличена точность поиска дублей: анализ 32×32 пикселей вместо 8×8 (в 16 раз больше данных)',
      'Добавлено обнаружение повернутых дублей (90°, 180°, 270°)',
      'Улучшена точность: цветовая гистограмма предотвращает ложные срабатывания',
      'Добавлено отображение прогресса поиска дублей и типа обнаружения',
      'Исправлены критические баги: race conditions при переименовании файлов, защита от симлинков',
      'Реализованы атомарные операции записи для history.json и settings.json',
      'Исправлена утечка файлов в download-manager при ошибках загрузки',
      'Оптимизировано логирование: проверка ротации раз в минуту вместо каждого вызова',
      'Скелетоны карточек теперь сразу отображаются квадратными формами',
      'Улучшена логика удаления превью и валидация поисковых запросов'
    ]
  },
  {
    version: '1.3.1',
    date: '',
    changes: [
      'Значительно улучшена плавность прокрутки галереи — скелетоны подгружаются заранее при быстром скролле',
      'Исправлена проблема с «дырами» в сетке при смене режима отображения (компактный ↔ обычный)',
      'Создан полноценный компонент скелетона карточки вместо простого placeholder',
      'Увеличена зона предзагрузки с 200px до 1000px для более плавного скролла',
      'Оптимизирован IntersectionObserver для корректной работы при изменении количества колонок'
    ]
  },
  {
    version: '1.3.0',
    date: '',
    changes: [
      'Исправлена иконка приложения в панели задач Windows',
      'Перестилизованы пустые состояния — контент теперь в левом верхнем углу',
      'Улучшена механика проверки дублей — пропущенные пары больше не показываются',
      'Добавлено объяснение принципов определения похожести изображений',
      'Добавлена кнопка для очистки списка пропущенных дублей'
    ]
  },
  {
    version: '1.2.9',
    date: '',
    changes: [
      'Исправлены критические ошибки, которые блокировали запуск приложения',
      'Добавлена поддержка импорта изображений напрямую из браузера',
      'Улучшена кроссплатформенность — теперь работает на Windows, macOS и Linux',
      'Оптимизированы горячие клавиши — больше никаких конфликтов с системой',
      'Добавлена защита от ошибок с путями к файлам',
      'Автообновления теперь работают корректно',
      'Окно "Что нового?" показывается автоматически после обновления'
    ]
  },
  {
    version: '1.2.8',
    date: '',
    changes: [
      'Drag-and-Drop для меток между категориями',
      'Опциональные метки при добавлении карточек',
      'Упрощен процесс импорта файлов'
    ]
  },
  {
    version: '1.2.7',
    date: '',
    changes: [
      'Улучшена производительность галереи для больших коллекций',
      'Добавлена возможность переноса рабочей папки',
      'Исправлены ошибки с генерацией превью для видео'
    ]
  },
  {
    version: '1.2.6',
    date: '',
    changes: [
      'Добавлена система резервного копирования с разбиением на части',
      'Улучшен поиск по тегам и категориям',
      'Исправлены проблемы с синхронизацией мудборда'
    ]
  },
  {
    version: '1.2.5',
    date: '',
    changes: [
      'Первая стабильная версия ARC',
      'Полноценная работа с карточками, коллекциями и метками',
      'Система мудборда для организации референсов',
      'Поддержка изображений и видео'
    ]
  }
];

/**
 * Получить изменения для конкретной версии
 */
export function getVersionChanges(version: string): VersionChange | undefined {
  return changelog.find(v => v.version === version);
}

/**
 * Получить все версии начиная с указанной
 */
export function getChangesSince(fromVersion: string): VersionChange[] {
  const fromIndex = changelog.findIndex(v => v.version === fromVersion);
  
  if (fromIndex === -1) {
    // Если версия не найдена, показываем только последнюю
    return changelog.slice(0, 1);
  }
  
  // Возвращаем все версии до указанной (не включая её)
  return changelog.slice(0, fromIndex);
}

/**
 * Получить последнюю версию
 */
export function getLatestVersion(): VersionChange {
  return changelog[0];
}

