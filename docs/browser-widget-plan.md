# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –û–±–∑–æ—Ä

–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π –≤–∏–¥–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–µ–±-—Å–∞–π—Ç–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –≤ ARC —á–µ—Ä–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. **–ë—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ** (Chrome/Edge/Firefox)
   - Content Script –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –í—Å–ø–ª—ã–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
   - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

2. **Electron –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (ARC)**
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–ø–∫–∏ –æ–∂–∏–¥–∞–Ω–∏—è
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

3. **–ú–µ—Ö–∞–Ω–∏–∑–º –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏**
   - –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø–∞–ø–∫–∞ `_pending` –≤ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
   - –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞–∫ –º–æ—Å—Ç –º–µ–∂–¥—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

## –ü—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä
2. –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ ARC"
3. –ö–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ ‚Üí –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É `_pending`
4. ARC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–π —Ñ–∞–π–ª
5. –§–∞–π–ª –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –º–µ—Ç–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### 1. –ë—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:
```
browser-extension/
‚îú‚îÄ‚îÄ manifest.json          # –ú–∞–Ω–∏—Ñ–µ—Å—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
‚îú‚îÄ‚îÄ content-script.js      # –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îú‚îÄ‚îÄ background.js          # –§–æ–Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ popup.html             # –ü–æ–ø–∞–ø –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ icons/                 # –ò–∫–æ–Ω–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
‚îî‚îÄ‚îÄ styles.css             # –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏
```

#### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

**Content Script:**
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –≤—Å–µ `<img>` —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –î–æ–±–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π `mouseenter`/`mouseleave`
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ ARC" –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
- –ü—Ä–∏ –∫–ª–∏–∫–µ:
  1. –ü–æ–ª—É—á–∞–µ—Ç URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–º–æ–∂–µ—Ç –±—ã—Ç—å data-src, srcset –∏ —Ç.–¥.)
  2. –°–∫–∞—á–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Fetch API
  3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ø–∞–ø–∫—É `_pending` —á–µ—Ä–µ–∑ Native Messaging –∏–ª–∏ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É

**–ü—Ä–æ–±–ª–µ–º–∞ CORS:**
- –ú–Ω–æ–≥–∏–µ —Å–∞–π—Ç—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ Fetch –∏–∑-–∑–∞ CORS
- –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `chrome.downloads.download()` API –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è

#### Manifest.json (Chrome/Edge):
```json
{
  "manifest_version": 3,
  "name": "ARC Save Button",
  "version": "1.0.0",
  "description": "–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ ARC –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º",
  "permissions": [
    "downloads",
    "storage",
    "activeTab"
  ],
  "host_permissions": [
    "<all_urls>"
  ],
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["content-script.js"],
      "css": ["styles.css"],
      "run_at": "document_idle"
    }
  ],
  "background": {
    "service_worker": "background.js"
  },
  "action": {
    "default_popup": "popup.html",
    "default_icon": {
      "16": "icons/icon16.png",
      "48": "icons/icon48.png",
      "128": "icons/icon128.png"
    }
  },
  "icons": {
    "16": "icons/icon16.png",
    "48": "icons/icon48.png",
    "128": "icons/icon128.png"
  }
}
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Electron –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–ø–∫–∏ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
- –†–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ (–Ω–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

1. **–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É `_pending` –≤ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:**
   ```typescript
   const pendingDir = path.join(workingDir, '_pending');
   await fs.mkdir(pendingDir, { recursive: true });
   ```

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ `fs.watch`:**
   ```typescript
   // –í main.ts –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–º –º–æ–¥—É–ª–µ
   import { watch } from 'fs';
   
   function watchPendingFolder(workingDir: string) {
     const pendingDir = path.join(workingDir, '_pending');
     
     watch(pendingDir, { recursive: false }, async (eventType, filename) => {
       if (eventType === 'rename' && filename) {
         const filePath = path.join(pendingDir, filename);
         
         // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–Ω–µ —É–¥–∞–ª–µ–Ω–∏–µ)
         const exists = await fs.access(filePath).then(() => true).catch(() => false);
         if (exists) {
           // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏–µ –≤ renderer –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å
           mainWindow?.webContents.send('pending-file-added', filePath);
         }
       }
     });
   }
   ```

3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ renderer:**
   ```typescript
   // –í AddPage –∏–ª–∏ AddCardFlow
   useEffect(() => {
     const handlePendingFile = async (filePath: string) => {
       // –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
       const fileBuffer = await window.electronAPI.readFile(filePath);
       const fileName = path.basename(filePath);
       
       // –°–æ–∑–¥–∞—ë–º File –æ–±—ä–µ–∫—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞
       const file = new File([fileBuffer], fileName, {
         type: getMimeType(fileName)
       });
       
       // –î–æ–±–∞–≤–ª—è–µ–º –≤ –æ—á–µ—Ä–µ–¥—å
       await processFiles([file]);
       
       // –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –∏–∑ _pending –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
       await window.electronAPI.deleteFile(filePath);
     };
     
     // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è
     window.electronAPI.onPendingFileAdded(handlePendingFile);
     
     return () => {
       window.electronAPI.offPendingFileAdded(handlePendingFile);
     };
   }, []);
   ```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Native Messaging (–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ü—Ä—è–º–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —Ä–µ–µ—Å—Ç—Ä–µ Windows
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –ú–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±—Ä–∞—É–∑–µ—Ä–∞

### 3. –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –±—ã—Ç—å –≤ `<img>`, `<picture>`, background-image, lazy-loaded
- –ù—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã URL (data:, blob:, –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏)

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// content-script.js
function getAllImages() {
  const images = [];
  
  // 1. –û–±—ã—á–Ω—ã–µ img —ç–ª–µ–º–µ–Ω—Ç—ã
  document.querySelectorAll('img').forEach(img => {
    const src = img.src || img.dataset.src || img.currentSrc;
    if (src && !src.startsWith('data:')) {
      images.push({
        element: img,
        url: getAbsoluteUrl(src),
        type: 'img'
      });
    }
  });
  
  // 2. Picture —ç–ª–µ–º–µ–Ω—Ç—ã
  document.querySelectorAll('picture source').forEach(source => {
    const srcset = source.srcset;
    if (srcset) {
      // –ü–∞—Ä—Å–∏–º srcset –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è URL
      const urls = parseSrcset(srcset);
      urls.forEach(url => {
        images.push({
          element: source,
          url: getAbsoluteUrl(url),
          type: 'picture'
        });
      });
    }
  });
  
  // 3. Background images (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ)
  // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é
  
  return images;
}

function getAbsoluteUrl(url) {
  if (url.startsWith('http')) return url;
  if (url.startsWith('//')) return window.location.protocol + url;
  return new URL(url, window.location.href).href;
}
```

### 4. –í—Å–ø–ª—ã–≤–∞—é—â–∞—è –∫–Ω–æ–ø–∫–∞

**–î–∏–∑–∞–π–Ω:**
- –ü–æ—è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (top-right corner)
- –°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –¥–∏–∑–∞–π–Ω–æ–º ARC

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```javascript
// content-script.js
function createSaveButton(imageData) {
  const button = document.createElement('div');
  button.className = 'arc-save-button';
  button.innerHTML = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ ARC';
  button.onclick = async (e) => {
    e.stopPropagation();
    await saveImageToARC(imageData.url);
    button.textContent = '‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!';
    setTimeout(() => button.remove(), 2000);
  };
  return button;
}

function showButtonOnHover(imageElement, imageData) {
  let button = null;
  
  imageElement.addEventListener('mouseenter', () => {
    button = createSaveButton(imageData);
    positionButton(button, imageElement);
    document.body.appendChild(button);
  });
  
  imageElement.addEventListener('mouseleave', () => {
    if (button) {
      button.remove();
      button = null;
    }
  });
}
```

### 5. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Chrome Downloads API:**
```javascript
// background.js –∏–ª–∏ content-script.js
async function saveImageToARC(imageUrl) {
  try {
    // –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ _pending –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
    const settings = await chrome.storage.local.get(['arcPendingPath']);
    
    if (!settings.arcPendingPath) {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      chrome.notifications.create({
        type: 'basic',
        iconUrl: 'icons/icon48.png',
        title: 'ARC Save Button',
        message: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ ARC –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è'
      });
      return;
    }
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–º—è —Ñ–∞–π–ª–∞
    const fileName = generateFileName(imageUrl);
    const downloadPath = path.join(settings.arcPendingPath, fileName);
    
    // –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª
    chrome.downloads.download({
      url: imageUrl,
      filename: downloadPath,
      saveAs: false,
      conflictAction: 'uniquify'
    }, (downloadId) => {
      if (chrome.runtime.lastError) {
        console.error('–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:', chrome.runtime.lastError);
      } else {
        console.log('–§–∞–π–ª —Å–∫–∞—á–∞–Ω:', downloadId);
      }
    });
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** Chrome Downloads API —Ç—Ä–µ–±—É–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å, –Ω–æ –º—ã –Ω–µ –∑–Ω–∞–µ–º –ø—É—Ç—å –∫ —Ä–∞–±–æ—á–µ–π –ø–∞–ø–∫–µ ARC –∏–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Native Messaging –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—É—Ç—å –≤ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏.

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: Native Messaging

### –ß—Ç–æ —ç—Ç–æ?
Native Messaging –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é –æ–±—â–∞—Ç—å—Å—è —Å –Ω–∞—Ç–∏–≤–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥/–≤—ã–≤–æ–¥.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –ü—Ä—è–º–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
- –ú–æ–∂–µ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø—É—Ç—å –∫ —Ä–∞–±–æ—á–µ–π –ø–∞–ø–∫–µ
- –ú–æ–∂–µ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é

### –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
- –¢—Ä–µ–±—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ —Ä–µ–µ—Å—Ç—Ä–µ Windows
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:

1. **–°–æ–∑–¥–∞—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–π —Ö–æ—Å—Ç-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```typescript
   // native-host.ts
   import * as readline from 'readline';
   import * as fs from 'fs';
   
   const rl = readline.createInterface({
     input: process.stdin,
     output: process.stdout
   });
   
   rl.on('line', async (line) => {
     try {
       const message = JSON.parse(line);
       
       if (message.type === 'save-image') {
         const { url, workingDir } = message;
         
         // –°–∫–∞—á–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
         const response = await fetch(url);
         const buffer = await response.arrayBuffer();
         
         // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ _pending
         const pendingDir = path.join(workingDir, '_pending');
         await fs.mkdir(pendingDir, { recursive: true });
         
         const fileName = generateFileName(url);
         const filePath = path.join(pendingDir, fileName);
         await fs.writeFile(filePath, Buffer.from(buffer));
         
         // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç
         console.log(JSON.stringify({ success: true, filePath }));
       }
     } catch (error) {
       console.error(JSON.stringify({ error: error.message }));
     }
   });
   ```

2. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Ä–µ–µ—Å—Ç—Ä–µ Windows:**
   ```json
   // registry-entry.json
   {
     "name": "com.arc.app.nativehost",
     "description": "ARC Native Messaging Host",
     "path": "C:\\Program Files\\ARC\\native-host.exe",
     "type": "stdio",
     "allowed_origins": [
       "chrome-extension://[EXTENSION_ID]/"
     ]
   }
   ```

3. **–í —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–∏:**
   ```javascript
   // background.js
   const nativeHostName = 'com.arc.app.nativehost';
   const port = chrome.runtime.connectNative(nativeHostName);
   
   port.onMessage.addListener((response) => {
     if (response.success) {
       console.log('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ:', response.filePath);
     }
   });
   
   port.onDisconnect.addListener(() => {
     console.error('–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –Ω–∞—Ç–∏–≤–Ω—ã–º —Ö–æ—Å—Ç–æ–º –ø–æ—Ç–µ—Ä—è–Ω–æ');
   });
   
   async function saveImageToARC(imageUrl) {
     // –ü–æ–ª—É—á–∞–µ–º –ø—É—Ç—å –∫ —Ä–∞–±–æ—á–µ–π –ø–∞–ø–∫–µ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ ARC
     const settings = await chrome.storage.local.get(['arcWorkingDir']);
     
     port.postMessage({
       type: 'save-image',
       url: imageUrl,
       workingDir: settings.arcWorkingDir
     });
   }
   ```

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥

**–ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**

1. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Chrome Downloads API** –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ –ø–∞–ø–∫—É Downloads
2. **ARC –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –ø–∞–ø–∫—É Downloads** (–∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –ø–æ–¥–ø–∞–ø–∫—É)
3. **ARC –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ñ–∞–π–ª—ã** –∏–∑ Downloads –≤ `_pending` –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç Native Messaging
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º –±—Ä–∞—É–∑–µ—Ä–æ–º
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ñ–∞–π–ª –≤ Downloads (–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å)

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É—Ç–∏ –∫ –ø–∞–ø–∫–µ Downloads –≤ ARC
- –ú–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å –¥—Ä—É–≥–∏–º–∏ –∑–∞–≥—Ä—É–∑–∫–∞–º–∏

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—Å–ø–ª—ã–≤–∞—é—â—É—é –∫–Ω–æ–ø–∫—É
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Downloads API

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ARC
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–ø–∫–∏ `_pending` –≤ Electron
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
- [ ] –î–æ–±–∞–≤–∏—Ç—å IPC handlers –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å pending —Ñ–∞–π–ª–∞–º–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å AddCardFlow –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ pending —Ñ–∞–π–ª–æ–≤

### –≠—Ç–∞–ø 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ UX
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–ø—É—Ç—å –∫ –ø–∞–ø–∫–µ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ ARC (–≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [ ] –£–ª—É—á—à–∏—Ç—å UX (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —Å–∞–π—Ç–∞—Ö
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases (CORS, –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã, blob URLs)
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **CORS:** –ú–Ω–æ–≥–∏–µ —Å–∞–π—Ç—ã –±–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Downloads API (–æ–±—Ö–æ–¥–∏—Ç CORS)

2. **Lazy loading:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
   - –†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MutationObserver –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

3. **Blob URLs:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç blob: URLs
   - –†–µ—à–µ–Ω–∏–µ: –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å blob –≤ data URL –ø–µ—Ä–µ–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º

4. **–ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** –ú–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é
   - –†–µ—à–µ–Ω–∏–µ: –°—Ç—Ä–∏–º–∏–Ω–≥ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: Bookmarklet
–ü—Ä–æ—Å—Ç–æ–π JavaScript –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ –∑–∞–∫–ª–∞–¥–∫–∏. –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–∞–∫–ª–∞–¥–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.

**–ü–ª—é—Å—ã:** –ù–µ —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
**–ú–∏–Ω—É—Å—ã:** –ú–µ–Ω–µ–µ —É–¥–æ–±–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 2: –°–µ—Ä–≤–∏—Å–Ω—ã–π –≤–æ—Ä–∫–µ—Ä
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Service Worker –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

**–ü–ª—é—Å—ã:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ
**–ú–∏–Ω—É—Å—ã:** –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å —Å–∞–π—Ç–∞–º–∏

## –í—ã–≤–æ–¥—ã

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥:** –ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –ø–∞–ø–∫–∏ Downloads.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
1. –ë–∞–∑–æ–≤–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–ø–∫–∏ –≤ ARC
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å
4. –£–ª—É—á—à–µ–Ω–∏–µ UX –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ edge cases

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 2-3 –Ω–µ–¥–µ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ + —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
