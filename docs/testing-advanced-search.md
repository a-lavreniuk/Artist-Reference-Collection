# Руководство по тестированию расширенного поиска

## Подготовка к тестированию

1. **Запустите dev-сервер:**
   ```bash
   start-dev.bat
   ```

2. **Убедитесь, что в БД есть тестовые данные:**
   - Минимум 3-5 категорий
   - Минимум 10-15 меток в разных категориях
   - Минимум 20-30 карточек с метками
   - Желательно наличие истории поиска

## Сценарии тестирования

### 1. Базовый поиск и автодополнение

**Цель:** Проверить работу фильтрации при вводе текста

**Шаги:**
1. Перейдите на страницу "Карточки"
2. Кликните в поле поиска
3. Начните вводить название существующей метки (например, "пейзаж")
4. Наблюдайте выпадающее меню

**Ожидаемый результат:**
- ✅ Выпадающее меню открывается автоматически
- ✅ Список меток фильтруется в реальном времени
- ✅ Показываются только метки, содержащие введенный текст
- ✅ Для каждой метки отображается категория и количество карточек
- ✅ Метки отсортированы по популярности (больше карточек = выше в списке)

---

### 2. Выбор метки

**Цель:** Проверить добавление метки к фильтру

**Шаги:**
1. В открытом выпадающем меню кликните на любую метку
2. Наблюдайте изменения в UI
3. Проверьте галерею карточек

**Ожидаемый результат:**
- ✅ Метка добавляется в область "Выбранные метки" над полем поиска
- ✅ Метка отображается с реальным названием (не ID)
- ✅ Метка подсвечивается в выпадающем меню как выбранная
- ✅ Галерея автоматически фильтруется, показывая только карточки с этой меткой
- ✅ Запись сохраняется в историю поиска

---

### 3. Множественный выбор меток

**Цель:** Проверить фильтрацию по нескольким меткам (логика AND)

**Шаги:**
1. Выберите первую метку (как в п.2)
2. Не закрывая выпадающее меню, выберите вторую метку
3. При желании выберите третью метку
4. Наблюдайте результаты

**Ожидаемый результат:**
- ✅ Все выбранные метки отображаются в "Выбранных метках"
- ✅ Галерея показывает только карточки, содержащие ВСЕ выбранные метки
- ✅ Если нет карточек с такой комбинацией, галерея пуста
- ✅ Количество найденных карточек отображается в заголовке

---

### 4. Удаление метки

**Цель:** Проверить снятие фильтра

**Шаги:**
1. Выберите несколько меток (как в п.3)
2. Кликните на крестик (×) рядом с одной из меток
3. Наблюдайте изменения

**Ожидаемый результат:**
- ✅ Метка удаляется из "Выбранных меток"
- ✅ Галерея автоматически обновляется
- ✅ Показываются карточки с оставшимися метками
- ✅ Если меток не осталось, показываются все карточки

---

### 5. Очистка всех фильтров

**Цель:** Проверить полный сброс поиска

**Шаги:**
1. Выберите несколько меток
2. Введите текст в поле поиска
3. Кликните кнопку "Очистить всё"

**Ожидаемый результат:**
- ✅ Все метки удаляются из "Выбранных меток"
- ✅ Поле поиска очищается
- ✅ Галерея показывает все карточки
- ✅ Выпадающее меню закрывается
- ✅ Очищенный фильтр сохраняется в историю

---

### 6. Фильтрация по категориям

**Цель:** Проверить фильтрацию меток по категории

**Шаги:**
1. Откройте выпадающее меню (без ввода текста)
2. В секции "Категории" кликните на любую категорию
3. Наблюдайте изменения в списке меток

**Ожидаемый результат:**
- ✅ Категория подсвечивается как активная
- ✅ В секции "Метки" отображаются только метки выбранной категории
- ✅ Появляется кнопка "Сбросить фильтр"
- ✅ Количество меток в категории отображается корректно

**Дополнительные проверки:**
- Кликните по категории повторно → фильтр сбрасывается
- Кликните "Сбросить фильтр" → фильтр сбрасывается
- Введите текст в поиск → фильтр категории остается активным

---

### 7. История поиска

**Цель:** Проверить сохранение и использование истории

**Шаги:**
1. Выполните несколько поисков с разными метками
2. Очистите фильтры (кнопка "Очистить всё")
3. Кликните в пустое поле поиска (не вводя текст)
4. В секции "История поиска" кликните на любую запись

**Ожидаемый результат:**
- ✅ История показывает последние 5 запросов
- ✅ Для каждой записи отображается текст запроса (если был) и количество меток
- ✅ Клик по записи восстанавливает этот поиск:
  - Текст запроса загружается в поле поиска
  - Метки добавляются в "Выбранные метки"
  - Галерея фильтруется автоматически
- ✅ Выпадающее меню закрывается после выбора

---

### 8. Пустые состояния

**Цель:** Проверить корректное отображение при отсутствии данных

**Шаги для каждого сценария:**

**A) Нет результатов поиска:**
1. Введите в поле поиска несуществующий текст (например, "zzzzzzz")
2. Наблюдайте выпадающее меню

**Ожидаемый результат:**
- ✅ Показывается сообщение "Ничего не найдено"
- ✅ Подсказка "Попробуйте изменить поисковый запрос"

**B) Нет меток в базе:**
1. Очистите все метки в базе данных (только для тестирования!)
2. Откройте выпадающее меню

**Ожидаемый результат:**
- ✅ Показывается сообщение "Нет меток"
- ✅ Подсказка "Создайте метки для организации карточек"

**C) Нет истории:**
1. Очистите историю поиска
2. Откройте выпадающее меню (без ввода текста)

**Ожидаемый результат:**
- ✅ Секция "История поиска" не отображается
- ✅ Показываются только категории и метки

---

### 9. Клавиатура и навигация

**Цель:** Проверить удобство использования

**Шаги:**
1. Используйте `Tab` для перехода к полю поиска
2. Нажмите `Esc` при открытом меню
3. Кликните вне компонента поиска

**Ожидаемый результат:**
- ✅ `Tab` корректно перемещает фокус на поле поиска
- ✅ `Esc` закрывает выпадающее меню
- ✅ Клик вне компонента закрывает выпадающее меню
- ✅ Фокус на поле поиска открывает выпадающее меню

---

### 10. Производительность

**Цель:** Проверить скорость работы с большими объемами данных

**Подготовка:**
- Создайте 50+ меток
- Создайте 100+ карточек

**Шаги:**
1. Откройте выпадающее меню
2. Начните быстро вводить текст
3. Прокрутите список меток
4. Выберите несколько меток подряд

**Ожидаемый результат:**
- ✅ Меню открывается за < 500мс
- ✅ Фильтрация работает плавно, без задержек
- ✅ Прокрутка списка плавная
- ✅ Выбор меток мгновенный
- ✅ Галерея обновляется с debounce (300мс)
- ✅ Показывается максимум 20 меток с сообщением о дополнительных

---

### 11. Адаптивность UI

**Цель:** Проверить корректное отображение на разных разрешениях

**Шаги:**
1. Измените размер окна приложения
2. Протестируйте на:
   - 1920×1080 (Full HD)
   - 2560×1440 (QHD)
   - Промежуточных размерах

**Ожидаемый результат:**
- ✅ Поле поиска корректно масштабируется
- ✅ Выпадающее меню не выходит за границы экрана
- ✅ Все элементы читаемы и кликабельны
- ✅ Отступы и размеры соответствуют дизайну

---

### 12. Интеграция с фильтрами

**Цель:** Проверить совместную работу поиска и фильтров типа контента

**Шаги:**
1. Выберите метку в поиске
2. Переключите фильтр "Все" → "Изображения"
3. Переключите на "Видео"
4. Добавьте еще одну метку

**Ожидаемый результат:**
- ✅ Фильтры работают независимо друг от друга
- ✅ Результаты учитывают оба фильтра одновременно
- ✅ Счетчики в заголовке обновляются корректно
- ✅ При смене фильтра выбранные метки сохраняются

---

### 13. Граничные случаи

**Цель:** Проверить поведение в нестандартных ситуациях

**Тесты:**

**A) Очень длинные названия:**
1. Создайте метку с названием > 50 символов
2. Выберите её в поиске

**Ожидаемый результат:**
- ✅ Название обрезается с многоточием (text-overflow: ellipsis)
- ✅ При наведении видно полное название (если реализован tooltip)

**B) Спецсимволы в названиях:**
1. Создайте метку с названием, содержащим спецсимволы (#, @, &, и т.д.)
2. Попробуйте найти её

**Ожидаемый результат:**
- ✅ Поиск работает корректно
- ✅ Спецсимволы отображаются правильно

**C) Быстрое переключение:**
1. Быстро открывайте/закрывайте выпадающее меню
2. Быстро выбирайте/снимайте метки

**Ожидаемый результат:**
- ✅ Нет багов с анимацией
- ✅ Нет "гонок данных" (race conditions)
- ✅ UI остается отзывчивым

---

## Чек-лист финальной проверки

Перед завершением тестирования убедитесь:

### Функциональность
- [ ] Поиск работает корректно
- [ ] Автодополнение фильтрует результаты
- [ ] Выбор меток обновляет галерею
- [ ] История сохраняется и восстанавливается
- [ ] Фильтрация по категориям работает
- [ ] Счетчики карточек корректны

### UI/UX
- [ ] Анимации плавные
- [ ] Все кнопки кликабельны
- [ ] Hover-эффекты работают
- [ ] Выбранные элементы визуально выделены
- [ ] Текст читаем на всех разрешениях

### Производительность
- [ ] Нет задержек при вводе
- [ ] Скроллинг плавный
- [ ] Большие списки обрабатываются быстро
- [ ] Нет утечек памяти при частом использовании

### Совместимость
- [ ] Работает с существующими фильтрами
- [ ] Не ломает другие страницы
- [ ] История не конфликтует с другими функциями

### Обработка ошибок
- [ ] Корректные сообщения при пустых состояниях
- [ ] Нет ошибок в консоли браузера
- [ ] Graceful degradation при проблемах с БД

---

## Отчет о тестировании

После завершения тестирования заполните:

**Дата:** ___________  
**Тестировщик:** ___________  
**Версия:** feature/advanced-search

### Найденные проблемы

| № | Описание | Серьезность | Статус |
|---|----------|-------------|--------|
| 1 | | | |
| 2 | | | |
| 3 | | | |

**Серьезность:**
- Критическая: функция не работает
- Высокая: значительные проблемы с UX
- Средняя: небольшие баги
- Низкая: косметические недочеты

### Общая оценка

- [ ] ✅ Готово к слиянию с main
- [ ] ⚠️ Требуются небольшие правки
- [ ] ❌ Требуется значительная доработка

**Комментарии:**
_____________________________________________________________________
_____________________________________________________________________

---

## Автоматизация тестирования (будущее)

Для автоматизации этих тестов можно использовать:
- **Playwright** - E2E тестирование
- **Vitest** - Unit тесты компонентов
- **Testing Library** - тестирование React компонентов

Пример теста:
```typescript
describe('SearchDropdown', () => {
  it('should filter tags by search query', async () => {
    render(<SearchDropdown searchQuery="пейзаж" ... />);
    const tags = await screen.findAllByRole('button');
    expect(tags).toHaveLength(expectedCount);
  });
});
```

